angular.module("admin42",["ui.bootstrap","ui.bootstrap.datetimepicker","ngAnimate","ngSanitize","ui.utils","smart-table","toaster","ngStorage","ui.sortable","ui.select","angularFileUpload"]),angular.module("admin42").config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("admin42").directive("delete",[function(){return{restrict:"E",templateUrl:"element/delete.html",scope:{callback:"="},controller:["$scope","$attrs","$modal","$window","$parse",function($scope,$attrs,$modal,$window){$scope.size=angular.isUndefined($attrs.size)?"lg":"lg"!=$attrs.size&&"sm"!=$attrs.size&&"xs"!=$attrs.size?"lg":$attrs.size,$scope.method=angular.isUndefined($attrs.method)?"post":"post"!=$attrs.method&&"delete"!=$attrs.method?"post":$attrs.method,$scope["delete"]=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"element/delete-modal.html",controller:"DeleteModalController",resolve:{requestUrl:function(){return $attrs.url},requestParams:function(){var params={};return angular.forEach($attrs,function(value,key){"request"==key.substring(0,7)&&(this[key.substring(7).toLowerCase()]=value)},params),params},requestTitle:function(){return $attrs.title},requestContent:function(){return $attrs.content},requestMethod:function(){return $scope.method}}});modalInstance.result.then(function(data){return angular.isDefined(data.redirect)?void($window.location.href=data.redirect):void(angular.isDefined($scope.callback)&&$scope.callback())},function(){})}}]}}]),angular.module("admin42").controller("DeleteModalController",["$scope","$modalInstance","$http","requestUrl","requestParams","requestTitle","requestContent","requestMethod",function($scope,$modalInstance,$http,requestUrl,requestParams,requestTitle,requestContent,requestMethod){$scope.title=requestTitle,$scope.content=requestContent,$scope.ok=function(){$http({method:requestMethod.toUpperCase(),url:requestUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:requestParams,transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$modalInstance.close(data)}).error(function(){$modalInstance.dismiss("cancel")})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("admin42").directive("adminDynamicForm",function(){return{restrict:"A",scope:{templateName:"@",adminDynamicFormElements:"@",adminDynamicPrototypes:"@",parentHashes:"="},templateUrl:function(elem,attrs){return attrs.baseForm},controller:["$scope","jsonCache",function($scope,jsonCache){$scope.data={},$scope.elements=angular.copy(jsonCache.get($scope.adminDynamicFormElements)),$scope.prototypes=jsonCache.get($scope.adminDynamicPrototypes),$scope.data.selectedPrototype=$scope.prototypes[0],$scope.makeid=function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;8>i;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},$scope.addTemplate=function(){var element=angular.copy($scope.data.selectedPrototype);element.hash=$scope.makeid(),$scope.elements.push(element)},$scope.sortableOptions={axis:"y",opacity:.5,handle:".panel-sort-handle",items:"> .sortable-container",placeholder:"sortable-placeholder",start:function(){$scope.$broadcast("$tinyWysiwyg:disable"),$scope.$emit("$tinyWysiwyg:disable")},stop:function(){$scope.$broadcast("$tinyWysiwyg:enable"),$scope.$emit("$tinyWysiwyg:enable")}}}]}}),angular.module("admin42").directive("dynamicModel",["$compile",function($compile){return{link:function(scope,element,attrs){scope.$watch(attrs.dynamicModel,function(dynamicModel){attrs.ngModel!=dynamicModel&&dynamicModel&&(element.attr("ng-model",dynamicModel),""==dynamicModel&&element.removeAttr("ng-model"),element.unbind(),$compile(element)(scope))})}}}]),angular.module("admin42").directive("uiFullscreen",["$document",function($document){return{restrict:"AC",template:'<i class="fa fa-expand fa-fw text"></i><i class="fa fa-compress fa-fw text-active"></i>',link:function(scope,el,attr){el.addClass("hide"),screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./)&&el.removeClass("hide"),el.on("click",function(){var target;attr.target&&(target=$(attr.target)[0]),screenfull.toggle(target)}),$document.on(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?el.addClass("active"):el.removeClass("active")})}}}]),angular.module("admin42").factory("jsonCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("json-cache")}]).directive("script",["jsonCache",function(jsonCache){return{restrict:"E",terminal:!0,compile:function(element,attr){if("application/json"==attr.type){var jsonHandler=attr.id,json=angular.fromJson(element[0].text);jsonCache.put(jsonHandler,json)}}}}]),angular.module("admin42").directive("uiNav",[function(){return{restrict:"AC",link:function(scope,el){var next,_window=$(window),_mb=768,wrap=$(".app-aside"),backdrop=".dropdown-backdrop";el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active"),_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault(),_this.next().is("ul")||_window.width()<_mb&&$(".app-aside").removeClass("show off-screen")}),el.on("mouseenter","a",function(e){if(next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<_mb||$(".app-aside-dock").length)){var top,_this=$(e.target),w_h=$(window).height(),offset=50,min=150;!_this.is("a")&&(_this=_this.closest("a")),_this.next().is("ul")&&(next=_this.next(),_this.parent().addClass("active"),top=_this.parent().position().top+offset,next.css("top",top),top+next.height()>w_h&&next.css("bottom",0),top+min>w_h&&next.css("bottom",w_h-top-offset).css("top","auto"),next.appendTo(wrap),next.on("mouseleave.nav",function(){$(backdrop).remove(),next.appendTo(_this.parent()),next.off("mouseleave.nav").css("top","auto").css("bottom","auto"),_this.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")}))}}),wrap.on("mouseleave",function(){next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove()})}}}]),angular.module("admin42").directive("ngInitial",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$parse",function($scope,$element,$attrs,$parse){var getter,setter,val,tag;tag=$element[0].tagName.toLowerCase(),val=$attrs.initialValue||$element.val(),"input"===tag&&("checkbox"===$element.attr("type")?val=$element[0].checked?!0:void 0:"radio"===$element.attr("type")&&(val=$element[0].checked||void 0!==$element.attr("selected")?$element.val():void 0)),$attrs.ngModel&&(getter=$parse($attrs.ngModel),(setter=getter.assign)($scope,val))}]}}),angular.module("smart-table").directive("stSearch42",["stConfig","$timeout",function(stConfig,$timeout){return{require:"^stTable",link:function(scope,element,attr,ctrl){var tableCtrl=ctrl,promise=null,throttle=attr.stDelay||stConfig.search.delay;attr.$observe("stSearch42",function(newValue,oldValue){var input=element[0].value;newValue!==oldValue&&input&&tableCtrl.search(input,newValue)}),scope.$watch(function(){return ctrl.tableState().search},function(newValue){var predicateExpression=attr.stSearch42||"$";newValue.predicateObject&&newValue.predicateObject[predicateExpression]!==element[0].value&&(element[0].value=newValue.predicateObject[predicateExpression]||"")},!0),element.bind("input",function(evt){evt=evt.originalEvent||evt,null!==promise&&$timeout.cancel(promise),promise=$timeout(function(){tableCtrl.search(evt.target.value,attr.stSearch42||""),promise=null},throttle)})}}}]),angular.module("admin42").directive("uiToggleClass",["$timeout","$document",function(){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){function magic(_class,target){for(var patt=new RegExp("\\s"+_class.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),cn=" "+$(target)[0].className+" ";patt.test(cn);)cn=cn.replace(patt," ");$(target)[0].className=$.trim(cn)}e.preventDefault();var classes=attr.uiToggleClass.split(","),targets=attr.target&&attr.target.split(",")||Array(el),key=0;angular.forEach(classes,function(_class){var target=targets[targets.length&&key];-1!==_class.indexOf("*")&&magic(_class,target),$(target).toggleClass(_class),key++}),$(el).toggleClass("active")})}}}]),angular.module("admin42").directive("tinyWysiwyg",["$timeout","$window",function($timeout){var editorCounter=0,idPrefix="tiny-wysiwyg";return{link:function(scope,element,attrs){var tinyInstance;attrs.$set("id",idPrefix+"-"+editorCounter++);var expression={};angular.extend(expression,scope.$eval(attrs.tinyWysiwyg));var options={format:"raw",selector:"#"+attrs.id};angular.extend(options,expression),$timeout(function(){tinymce.init(options),tinyInstance=tinymce.get(attrs.id)}),scope.$on("$tinyWysiwyg:disable",function(){tinymce.execCommand("mceRemoveEditor",!1,attrs.id)}),scope.$on("$tinyWysiwyg:enable",function(){tinymce.execCommand("mceAddEditor",!1,attrs.id)})}}}]),angular.module("admin42").directive("youtube",[function(){return{restrict:"E",scope:!0,transclude:!1,controller:["$scope","$sce","$attrs",function($scope,$sce,$attrs){$scope.youtubeCode=$attrs.youtubeCode,$scope.changeValue=function(){var regExp=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,match=$scope.youtubeLink.match(regExp);match&&11==match[2].length?($scope.youtubeCode=match[2],$scope.youtubeLink="https://www.youtube.com/?v="+$scope.youtubeCode):$scope.youtubeCode=""},$scope.videoUrl=function(){return $sce.trustAsResourceUrl("https://www.youtube.com/embed/"+$scope.youtubeCode)}}]}}]),angular.module("admin42").filter("bytes",function(){return function(bytes){if(isNaN(parseFloat(bytes))||!isFinite(bytes)||0==bytes)return"0";var measure,floor,precision,units={1:"KB",2:"MB",3:"GB",4:"TB"};return bytes>0xffffffffff?measure=4:bytes>1048575999&&0xffffffffff>=bytes?measure=3:bytes>1024e3&&1048575999>=bytes?measure=2:1024e3>=bytes&&(measure=1),floor=Math.floor(bytes/Math.pow(1024,measure)).toString().length,precision=floor>3?0:3-floor,(bytes/Math.pow(1024,measure)).toFixed(precision)+" "+units[measure]}}),angular.module("admin42").filter("datetime",function(appConfig){return function(input,emptyValue,format,timezone){angular.isUndefined(emptyValue)&&(emptyValue="-"),angular.isUndefined(format)&&(format=appConfig.defaultDateTimeFormat),angular.isUndefined(timezone)&&(timezone=appConfig.timezone);var dateTime;if(angular.isObject(input)&&"Date"==input.constructor.name)dateTime=moment.tz(moment.utc(input),input.timezone);else if(angular.isObject(input)){if(angular.isUndefined(input.date))return emptyValue;dateTime=moment.tz(moment.utc(input.date),input.timezone)}else{if(!angular.isString(input))return emptyValue;if(0==input.length)return emptyValue;dateTime=moment.tz(moment.utc(input),timezone)}return dateTime.locale(appConfig.locale),dateTime.format(format)}}),angular.module("admin42").controller("AppController",["$scope","toaster","$timeout","$localStorage",function($scope,toaster,$timeout,$localStorage){$scope.app={$storage:$localStorage.$default({asideFolded:!1})},$scope.app.appContentFull=!1,"undefined"!=typeof FLASH_MESSAGE&&$timeout(function(){angular.forEach(FLASH_MESSAGE,function(messages,namespace){0!=messages.length&&angular.forEach(messages,function(message){toaster.pop(namespace,message.title,message.message)})})},1e3)}]),angular.module("admin42").controller("CropController",["$scope","$http","$timeout","Cropper","jsonCache","$attrs","$interval",function($scope,$http,$timeout,Cropper,jsonCache,$attrs,$interval){function setCurrentInfo(currentInfo){var dimension=$scope.dimensions[$scope.selectedHandle];if("auto"!=dimension.width&&"auto"!=dimension.height)currentInfo.calcWidth=dimension.width,currentInfo.calcHeight=dimension.height;else if("auto"==dimension.width&&"auto"==dimension.height)currentInfo.calcWidth=currentInfo.width,currentInfo.calcHeight=currentInfo.height;else if("auto"==dimension.width&&"auto"!=dimension.height){var ratio=currentInfo.height/dimension.height;currentInfo.calcWidth=Math.round(currentInfo.width/ratio),currentInfo.calcHeight=dimension.height}else{var ratio=currentInfo.width/dimension.width;currentInfo.calcWidth=dimension.width,currentInfo.calcHeight=Math.round(currentInfo.height/ratio)}$scope.currentInfo=currentInfo,$scope.$apply()}function stopInterval(){$interval.cancel(stop)}$scope.data=[],$scope.dimensions=jsonCache.get($attrs.json).dimension,$scope.meta=jsonCache.get($attrs.json).meta,$scope.selectedHandle=null;var imageSize=jsonCache.get($attrs.json).imageSize;$scope.hasChanges={},$scope.currentInfo={x:0,y:0,width:0,height:0,rotate:0,calcWidth:0,calcHeight:0},$scope.isActive=function(handle){return handle==$scope.selectedHandle?"active":""},$scope.checkChanges=function(handle){return angular.isUndefined($scope.data[handle])?!1:angular.isUndefined($scope.meta[handle])?!0:$scope.data[handle].x==$scope.meta[handle].x&&$scope.data[handle].y==$scope.meta[handle].y&&$scope.data[handle].width==$scope.meta[handle].width&&$scope.data[handle].height==$scope.meta[handle].height?!1:!0},$scope.checkImageSize=function(currentDimension){return imageSize.width<currentDimension.width||imageSize.height<currentDimension.height?!1:!0},angular.forEach($scope.dimensions,function(value,key){null===this.selectedHandle&&this.checkImageSize(value)&&(this.selectedHandle=key)},$scope),$scope.saveCroppedImage=function(handle,url){return angular.isUndefined($scope.data[handle])?!1:(url=url.replace("{{ name }}",handle),void $http.post(url,$scope.data[handle]))},$scope.selectDimension=function(handle){$scope.currentInfo={x:0,y:0,width:0,height:0,rotate:0,calcWidth:0,calcHeight:0};var dimension=$scope.dimensions[handle];Cropper.getJqueryCrop().cropper("destroy"),$scope.selectedHandle=handle;var options={crop:function(dataNew){$scope.data[$scope.selectedHandle]=dataNew},strict:!0,zoomable:!1,responsive:!0,rotatable:!1,guides:!0};angular.isUndefined($scope.data[handle])?angular.isUndefined($scope.meta[handle])?(options.data={width:dimension.width,height:dimension.height,rotate:0},options.built=function(){var data=$(this).cropper("getData"),imageData=$(this).cropper("getImageData"),x=(imageData.naturalWidth-data.width)/2,y=(imageData.naturalHeight-data.height)/2;$(this).cropper("setData",{x:x,y:y})}):options.data={x:$scope.meta[handle].x,y:$scope.meta[handle].y,width:$scope.meta[handle].width,height:$scope.meta[handle].height,rotate:0}:options.data=$scope.data[handle],"auto"!=dimension.width&&"auto"!=dimension.height&&(options.aspectRatio=dimension.width/dimension.height),Cropper.getJqueryCrop().off("dragmove.cropper"),Cropper.getJqueryCrop().off("dragstart.cropper"),Cropper.getJqueryCrop().cropper(options),Cropper.getJqueryCrop().on("dragmove.cropper",function(e){var $cropper=$(e.target),data=$cropper.cropper("getCropBoxData"),imageData=$cropper.cropper("getImageData");return setCurrentInfo($cropper.cropper("getData",!0)),"auto"!=dimension.width&&data.width<dimension.width/(imageData.naturalWidth/imageData.width)?!1:"auto"!=dimension.height&&data.height<dimension.height/(imageData.naturalHeight/imageData.height)?!1:!0}).on("dragstart.cropper",function(e){var $cropper=$(e.target),data=$cropper.cropper("getCropBoxData"),imageData=$cropper.cropper("getImageData"),hasChanged=!1;if(setCurrentInfo($cropper.cropper("getData",!0)),"auto"!=dimension.width){var width=dimension.width/(imageData.naturalWidth/imageData.width);(angular.isUndefined(data.width)||data.width<width)&&(data.width=width,hasChanged=!0)}if("auto"!=dimension.height){var height=dimension.height/(imageData.naturalHeight/imageData.height);(angular.isUndefined(data.height)||data.height<height)&&(data.height=height,hasChanged=!0)}$scope.hasChanges[handle]=!0,$scope.$apply(),hasChanged&&$(e.target).cropper("setCropBoxData",data)}).on("built.cropper",function(e){var $cropper=$(e.target);setCurrentInfo($cropper.cropper("getData",!0))})};var stop=$interval(function(){null!=Cropper.getJqueryCrop()&&null!=$scope.selectedHandle&&($scope.selectDimension($scope.selectedHandle),stopInterval())},100)}]),angular.module("admin42").directive("ngCropper",["Cropper",function(Cropper){return{restrict:"A",link:function(scope,element){Cropper.setJqueryCrop(element)}}}]).service("Cropper",[function(){this.crop=null,this.setJqueryCrop=function(crop){this.crop=crop},this.getJqueryCrop=function(){return this.crop}}]),angular.module("admin42").controller("DataGridController",["$scope","$http","$attrs","$sessionStorage","$templateCache",function($scope,$http,$attrs,$sessionStorage,$templateCache){$templateCache.put("template/smart-table/pagination.html",'<nav ng-if="numPages && pages.length >= 2"><ul class="pagination"><li ng-if="currentPage > 1"><a ng-click="selectPage(1)"><i class="fa fa-angle-double-left"></i></a></li><li ng-if="currentPage > 1"><a ng-click="selectPage(currentPage - 1)"><i class="fa fa-angle-left"></i></a></li><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li><li ng-if="currentPage < numPages"><a ng-click="selectPage(currentPage + 1)"><i class="fa fa-angle-right"></i></a></li><li ng-if="currentPage < numPages"><a ng-click="selectPage(numPages)"><i class="fa fa-angle-double-right"></i></a></li></ul></nav>');var url=$attrs.url,isInitialCall=!0,persistNamespace=null;angular.isDefined($attrs.persist)&&$attrs.persist.length>0&&(persistNamespace=$attrs.persist),$scope.collection=[],$scope.isLoading=!0,$scope.displayedPages=1,$scope.callServer=function(tableState){$scope.collection=[],$scope.isLoading=!0,isInitialCall===!0&&null!==persistNamespace?angular.isDefined($sessionStorage.smartTable)&&angular.isDefined($sessionStorage.smartTable[persistNamespace])&&angular.extend(tableState,angular.fromJson($sessionStorage.smartTable[persistNamespace])):null!==persistNamespace&&(angular.isUndefined($sessionStorage.smartTable)&&($sessionStorage.smartTable={}),$sessionStorage.smartTable[persistNamespace]=angular.toJson(tableState)),isInitialCall=!1,$http.post(url,tableState).success(function(data){$scope.isLoading=!1,$scope.collection=data.data,$scope.displayedPages=data.meta.displayedPages,tableState.pagination.numberOfPages=data.meta.displayedPages}).error(function(){})}}]),angular.module("admin42").controller("AdminDatepickerController",["$scope","$attrs",function($scope){$scope.opened=!1,$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.opened=!0},$scope.dateOptions={formatYear:"yy",startingDay:1,enableDate:!0,enableTime:!0,"class":"datepicker",showWeeks:!1,timeText:"Time",startingDay:1}}]),angular.module("admin42").controller("FileSelectorController",["$scope","$attrs","jsonCache","$modal","MediaService",function($scope,$attrs,jsonCache,$modal,MediaService){$scope.media=jsonCache.get($attrs.jsonDataId),$scope.tabs={media:{active:"file"!==$attrs.ngType,disabled:!1},sitemap:{active:"file"===$attrs.ngType,disabled:"file"!==$attrs.ngType}},$scope.clearMedia=function(){$scope.media=[]},$scope.isImage=function(){return angular.isUndefined($scope.media.mimeType)?!1:"image/"==$scope.media.mimeType.substr(0,6)},$scope.getSrc=function(media,dimension){return MediaService.getMediaUrl(media.directory,media.filename,media.mimeType,dimension)},$scope.selectMedia=function(){var modalInstance=$modal.open({animation:!0,templateUrl:$attrs.modalTemplate,controller:"MediaModalSelectorController",size:"lg"});modalInstance.result.then(function(media){null!==media&&($scope.media=media)},function(){})}}]),angular.module("admin42").controller("MediaModalSelectorController",["$scope","$modalInstance",function($scope,$modalInstance){var selectedMedia=null;$scope.selectMedia=function(media){return $scope.selectedMedia==media.id?($scope.selectedMedia=null,void(selectedMedia=null)):($scope.selectedMedia=media.id,void(selectedMedia=media))},$scope.ok=function(){$modalInstance.close(selectedMedia)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("admin42").controller("LinkController",["$scope","$attrs","$modal","jsonCache",function($scope,$attrs,$modal,jsonCache){$scope.linkId=jsonCache.get($attrs.jsonDataId).linkId,$scope.linkType=jsonCache.get($attrs.jsonDataId).linkType,$scope.linkValue=jsonCache.get($attrs.jsonDataId).linkValue,$scope.linkDisplayName=jsonCache.get($attrs.jsonDataId).linkDisplayName,$scope.selectLink=function(){var modalInstance=$modal.open({animation:!0,templateUrl:"linkModalSelectorContent.html",controller:"LinkModalSelectorController",size:"lg",resolve:{linkSaveUrl:function(){return $attrs.linkSaveUrl},linkType:function(){return $scope.linkType},linkValue:function(){return $scope.linkValue},linkId:function(){return $scope.linkId}}});modalInstance.result.then(function(data){$scope.linkId=data.linkId,$scope.linkDisplayName=data.linkDisplayName,$scope.linkValue=data.linkValue,$scope.linkType=data.linkType},function(){})},$scope.clearLink=function(){$scope.linkId="",$scope.linkDisplayName=""}}]),angular.module("admin42").controller("LinkModalSelectorController",["$scope","$modalInstance","$http","linkSaveUrl","linkType","linkValue","linkId",function($scope,$modalInstance,$http,linkSaveUrl,linkType,linkValue,linkId){$scope.includeArray=[],$scope.link={setValue:function(value){linkValue=value},getValue:function(){return linkValue}},$scope.change=function(){return $scope.linkType.length>0?void($scope.includeArray=["/link/"+$scope.linkType+".html"]):void($scope.includeArray=[])},null!==linkType&&($scope.linkType=linkType,$scope.change()),$scope.ok=function(){return null==linkValue||0==$scope.linkType.length?void $modalInstance.close({linkId:null,linkDisplayName:null,linkValue:null,linkType:null}):void $http({method:"POST",url:linkSaveUrl,data:{type:$scope.linkType,value:linkValue,id:linkId}}).success(function(data){$modalInstance.close({linkId:data.linkId,linkDisplayName:data.linkDisplayName,linkValue:linkValue,linkType:$scope.linkType})}).error(function(){$modalInstance.dismiss("cancel")})},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("admin42").controller("LinkExternController",["$scope",function($scope){var inititalValue=$scope.link.getValue();null!=inititalValue?($scope.externType=inititalValue.type,$scope.externUrl=inititalValue.url):$scope.externType="http://",$scope.change=function(){$scope.link.setValue({type:$scope.externType,url:$scope.externUrl})}}]),angular.module("admin42").controller("LinkMediaController",["$scope",function($scope){$scope.selectedMedia=null;var inititalValue=$scope.link.getValue();null!=inititalValue&&($scope.selectedMedia=inititalValue.id),$scope.selectMedia=function(media){return $scope.selectedMedia==media.id?($scope.selectedMedia=null,void(selectedMedia=null)):($scope.selectedMedia=media.id,void $scope.link.setValue({id:media.id}))}}]),angular.module("admin42").controller("LinkDialogController",["$scope","$http",function($scope,$http){$scope.includeArray=[],$scope.linkSelection={type:null,value:null};var linkValue=null;$scope.link={setValue:function(value){linkValue=value,$scope.linkSelection.value=value},getValue:function(){return linkValue}},$scope.change=function(){return $scope.linkType.length>0?($scope.includeArray=["/link/"+$scope.linkType+".html"],void($scope.linkSelection.type=$scope.linkType)):void($scope.includeArray=[])},$scope.ok=function(){null!=linkValue&&0!=$scope.linkType.length&&$http({method:"POST",url:linkSaveUrl,data:{type:$scope.linkType,value:linkValue,id:linkId}}).success(function(){}).error(function(){})},$scope.cancel=function(){}}]),angular.module("admin42").controller("MediaController",["$scope","FileUploader","$attrs","$http","toaster","MediaService",function($scope,FileUploader,$attrs,$http,toaster,MediaService){function requestFromServer(url,tableState){$scope.collection=[],$scope.isLoading=!0,$http.post(url,tableState).success(function(data){$scope.isLoading=!1,$scope.collection=data.data,$scope.displayedPages=data.meta.displayedPages,tableState.pagination.numberOfPages=data.meta.displayedPages}).error(function(){})}var currentTableState={},url=$attrs.url;$scope.isCollapsed=!0,$scope.collection=[],$scope.isLoading=!0,$scope.displayedPages=1,$scope.errorFiles=[],$scope.category=$attrs.category;var uploader=$scope.uploader=new FileUploader({url:$attrs.uploadUrl,filters:[{name:"filesize",fn:function(item){return item.size>$attrs.maxFileSize?($scope.errorFiles.push(item),!1):!0}}]});$scope.uploadCategoryChange=function(){$("#categorySearchSelect").val($scope.category),angular.element($("#categorySearchSelect")[0]).triggerHandler("input")},uploader.onBeforeUploadItem=function(item){item.formData=[{category:$scope.category}]},uploader.onCompleteAll=function(){requestFromServer(url,currentTableState),$scope.errorFiles=[]},$scope.isImage=function(item){return"image/"==item.mimeType.substr(0,6)},$scope.getDocumentClass=function(){return"fa-file"},$scope.callServer=function(tableState){currentTableState=tableState,requestFromServer(url,tableState)},$scope.getSrc=function(media,dimension){return MediaService.getMediaUrl(media.directory,media.filename,media.mimeType,dimension)}}]),angular.module("admin42").controller("ModalController",["$scope","$modalInstance",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("admin42").controller("NotificationController",["$scope","$interval","$http","$attrs",function($scope,$interval,$http,$attrs){var notificationUrl=$attrs.notificationUrl,updateNotifications=function(){$http.get(notificationUrl).success(function(data){$scope.notifications=data}).error(function(){$scope.notifications=[]})};$scope.notifications=[],$interval(updateNotifications,3e4),updateNotifications(),$scope.clearNotifications=function(clearUrl){$http.post(clearUrl).success(function(){$scope.notifications=[]}).error(function(){})}}]),angular.module("admin42").controller("SelectController",["$scope","$attrs","jsonCache",function($scope,$attrs,jsonCache){$scope.items=jsonCache.get($attrs.jsonDataId),$scope.item={},$attrs.initValue.length>0&&angular.forEach($scope.items,function(value){value.id==$attrs.initValue&&($scope.item.selected=value)})}]),angular.module("admin42").controller("TagsElementController",["$scope","$attrs","$http","$q","jsonCache",function($scope,$attrs,$http,$q,jsonCache){var url=$attrs.url,canceler=null;$scope.tags={tags:[],selectedTags:jsonCache.get($attrs.jsonDataId),fieldValue:""},$scope.addTagTransform=function(tag){return{id:0,tag:tag}},$scope.updateHiddenField=function(){var fieldValue="";angular.forEach($scope.tags.selectedTags,function(value){fieldValue+=value.tag+","}),$scope.tags.fieldValue=fieldValue.substring(0,fieldValue.length-1)},$scope.updateHiddenField(),$scope.refreshTags=function(tag){$scope.tags.tags=[];var params={tag:tag};if(tag.length>0){null!=canceler&&canceler.resolve(),canceler=$q.defer();var request=$http({method:"get",url:url,params:params,timeout:canceler.promise});request.then(function(response){$scope.canceler=null,$scope.tags.tags=response.data.results})}}}]),angular.module("admin42").controller("WysiwygController",function($scope,$attrs,$http){function fileBrowser(field_name,url,type,win){var fileBrowserUrl=$attrs.ngFileBrowser,dialogTitles=angular.fromJson($attrs.ngFileBrowserTitles)||{};if(!fileBrowserUrl)return void alert("File browser URL missing (ng-file-browser)");fileBrowserUrl+="?type="+type;var current=$("#"+field_name).val();""!==current&&(fileBrowserUrl+="&current="+encodeURIComponent(current));tinymce.activeEditor.windowManager.open({file:fileBrowserUrl,title:dialogTitles[type]||"File Browser",width:800,height:450,resizable:"yes",buttons:[{text:"Done",onclick:function(e){var frame=$(e.currentTarget).find("iframe").get(0),content=frame.contentDocument,selectedItem=$(content).find("input#linkSelection"),linkData=selectedItem.val();0==linkData.length&&top.tinymce.activeEditor.windowManager.close(),linkData=angular.fromJson(linkData),angular.isUndefined(linkData.type)&&top.tinymce.activeEditor.windowManager.close(),$http({method:"POST",url:$attrs.ngLinkSaveUrl,data:linkData}).success(function(data){win.document.getElementById(field_name).value=data.url,top.tinymce.activeEditor.windowManager.close()}).error(function(){top.tinymce.activeEditor.windowManager.close()})}},{text:"Cancel",onclick:function(){top.tinymce.activeEditor.windowManager.close()}}]},{field_name:field_name,type:type,win:win})}$attrs.ngBaseUrl&&(tinymce.baseURL=$attrs.ngBaseUrl),$scope.tinymceOptionsFull={trusted:!0,format:"raw",height:400,file_browser_callback:fileBrowser,plugins:"paste autolink lists charmap table code link",menubar:!1,toolbar:"undo redo paste | styleselect | bold italic | link unlink | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | table code | ",skin:"lightgray",theme:"modern",elementpath:!1,convert_urls:!1,resize:!0}}),angular.module("admin42").service("MediaService",["jsonCache",function(jsonCache){this.getMediaUrl=function(directory,filename,mimeType,dimension){if(angular.isUndefined(directory)||angular.isUndefined(filename))return"";var mediaConfig=jsonCache.get("mediaConfig");if(directory=directory.replace("data/media",""),"image/"!=mimeType.substr(0,6)||null==dimension)return mediaConfig.baseUrl+directory+filename;if(angular.isUndefined(mediaConfig.dimensions[dimension]))return mediaConfig.baseUrl+directory+filename;var currentDimension=mediaConfig.dimensions[dimension],extension=filename.split(".").pop();return filename=filename.substr(0,filename.length-extension.length-1),filename=filename+"-"+("auto"==currentDimension.width?"":currentDimension.width)+"x"+("auto"==currentDimension.height?"":currentDimension.height)+"."+extension,mediaConfig.baseUrl+directory+filename}}]);