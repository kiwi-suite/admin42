angular.module("admin42",["ui.bootstrap","ngAnimate","ngSanitize","ui.utils","smart-table","toaster","ngStorage","ui.sortable","ui.select"]),angular.module("admin42").config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),angular.module("admin42").directive("adminDynamicForm",[function(){return{restrict:"A",scope:{templateName:"@",adminDynamicFormElements:"@",adminDynamicPrototypes:"@"},templateUrl:"dynamic_form/base.html",controller:["$scope",function($scope){$scope.data={},$scope.elements=angular.fromJson($scope.adminDynamicFormElements),$scope.prototypes=angular.fromJson($scope.adminDynamicPrototypes),$scope.data.selectedPrototype=$scope.prototypes[0],$scope.addTemplate=function(){$scope.elements.push($scope.data.selectedPrototype)},$scope.sortableOptions={axis:"y",opacity:.5,handle:".panel-sort-handle",items:"> .sortable-container",placeholder:"sortable-placeholder"},$scope.getName=function(element,name,index){return element.initial===!1?element.name+"["+index+"]["+name+"]":element.name+"["+name+"]"}}]}}]),angular.module("admin42").directive("uiFullscreen",["$document",function($document){return{restrict:"AC",template:'<i class="fa fa-expand fa-fw text"></i><i class="fa fa-compress fa-fw text-active"></i>',link:function(scope,el,attr){el.addClass("hide"),screenfull.enabled&&!navigator.userAgent.match(/Trident.*rv:11\./)&&el.removeClass("hide"),el.on("click",function(){var target;attr.target&&(target=$(attr.target)[0]),screenfull.toggle(target)}),$document.on(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?el.addClass("active"):el.removeClass("active")})}}}]),angular.module("admin42").factory("jsonCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("json-cache")}]).directive("script",["jsonCache",function(jsonCache){return{restrict:"E",terminal:!0,compile:function(element,attr){if("application/json"==attr.type){var jsonHandler=attr.id,json=angular.fromJson(element[0].text);jsonCache.put(jsonHandler,json)}}}}]),angular.module("admin42").directive("uiNav",[function(){return{restrict:"AC",link:function(scope,el){var next,_window=$(window),_mb=768,wrap=$(".app-aside"),backdrop=".dropdown-backdrop";el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active"),_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault(),_this.next().is("ul")||_window.width()<_mb&&$(".app-aside").removeClass("show off-screen")}),el.on("mouseenter","a",function(e){if(next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<_mb||$(".app-aside-dock").length)){var top,_this=$(e.target),w_h=$(window).height(),offset=50,min=150;!_this.is("a")&&(_this=_this.closest("a")),_this.next().is("ul")&&(next=_this.next(),_this.parent().addClass("active"),top=_this.parent().position().top+offset,next.css("top",top),top+next.height()>w_h&&next.css("bottom",0),top+min>w_h&&next.css("bottom",w_h-top-offset).css("top","auto"),next.appendTo(wrap),next.on("mouseleave.nav",function(){$(backdrop).remove(),next.appendTo(_this.parent()),next.off("mouseleave.nav").css("top","auto").css("bottom","auto"),_this.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")}))}}),wrap.on("mouseleave",function(){next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove()})}}}]),angular.module("smart-table").directive("stSearch42",["stConfig","$timeout",function(stConfig,$timeout){return{require:"^stTable",link:function(scope,element,attr,ctrl){var tableCtrl=ctrl,promise=null,throttle=attr.stDelay||stConfig.search.delay;attr.$observe("stSearch42",function(newValue,oldValue){var input=element[0].value;newValue!==oldValue&&input&&tableCtrl.search(input,newValue)}),scope.$watch(function(){return ctrl.tableState().search},function(newValue){var predicateExpression=attr.stSearch42||"$";newValue.predicateObject&&newValue.predicateObject[predicateExpression]!==element[0].value&&(element[0].value=newValue.predicateObject[predicateExpression]||"")},!0),element.bind("input",function(evt){evt=evt.originalEvent||evt,null!==promise&&$timeout.cancel(promise),promise=$timeout(function(){tableCtrl.search(evt.target.value,attr.stSearch42||""),promise=null},throttle)})}}}]),angular.module("admin42").filter("datetime",function(appConfig){return function(input,emptyValue,format,timezone){angular.isUndefined(emptyValue)&&(emptyValue="-"),angular.isUndefined(format)&&(format=appConfig.defaultDateTimeFormat),angular.isUndefined(timezone)&&(timezone=appConfig.timezone);var dateTime;if(angular.isObject(input)){if(angular.isUndefined(input.date))return emptyValue;dateTime=moment.tz(input.date,input.timezone)}else{if(!angular.isString(input))return emptyValue;if(0==input.length)return emptyValue;dateTime=moment.tz(input,timezone)}return dateTime.locale(appConfig.locale),dateTime.format(format)}}),angular.module("admin42").controller("AppController",["$scope","toaster","$timeout","$localStorage",function($scope,toaster,$timeout,$localStorage){$scope.app={$storage:$localStorage.$default({asideFolded:!1})},$timeout(function(){angular.forEach(FLASH_MESSAGE,function(messages,namespace){0!=messages.length&&angular.forEach(messages,function(message){toaster.pop(namespace,message.title,message.message)})})},1e3)}]),angular.module("admin42").controller("DataGridController",["$scope","$http","$attrs",function($scope,$http,$attrs){var url=$attrs.url;$scope.collection=[],$scope.isLoading=!0,$scope.displayedPages=1,$scope.callServer=function(tableState){$scope.collection=[],$scope.isLoading=!0,$http.post(url,tableState).success(function(data){$scope.isLoading=!1,$scope.collection=data.data,$scope.displayedPages=data.meta.displayedPages,tableState.pagination.numberOfPages=data.meta.displayedPages}).error(function(){})}}]),angular.module("admin42").controller("ModalController",["$scope","$modalInstance",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("admin42").controller("NotificationController",["$scope","$interval","$http","$attrs",function($scope,$interval,$http,$attrs){var notificationUrl=$attrs.notificationUrl,updateNotifications=function(){$http.get(notificationUrl).success(function(data){$scope.notifications=data}).error(function(){$scope.notifications=[]})};$scope.notifications=[],$interval(updateNotifications,3e4),updateNotifications(),$scope.clearNotifications=function(clearUrl){$http.post(clearUrl).success(function(){$scope.notifications=[]}).error(function(){})}}]),angular.module("admin42").controller("SelectController",["$scope","$attrs","jsonCache",function($scope,$attrs,jsonCache){$scope.items=jsonCache.get($attrs.jsonDataId),$scope.item={},$attrs.initValue.length>0&&angular.forEach($scope.items,function(value){value.id==$attrs.initValue&&($scope.item.selected=value)})}]);