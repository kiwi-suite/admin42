angular.module("admin42",["ui.bootstrap","ngAnimate","ngSanitize","ui.validate","smart-table","toaster","ngStorage","ui.select","ui.tree"]),angular.module("admin42").config(["$httpProvider","$compileProvider",function($httpProvider,$compileProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$compileProvider.debugInfoEnabled(!1)}]),angular.module("admin42").factory("$formService",["$cacheFactory","jsonCache",function($cacheFactory,jsonCache){function getFormFactory(formId){var name="formService"+formId;return hash.hasOwnProperty(name)||(hash[name]=$cacheFactory(name)),hash[name]}var hash={};return{get:function(formId,key){return jsonCache.get(getFormFactory(formId).get(key))},put:function(formId,key,value){return getFormFactory(formId).put(key,value)},remove:function(formId,key){return getFormFactory(formId).remove(key)},removeAll:function(formId){return getFormFactory(formId).removeAll()},destroy:function(formId){return getFormFactory(formId).destroy()},info:function(formId){return getFormFactory(formId).info()}}}]),angular.module("admin42").directive("delete",[function(){return{restrict:"E",templateUrl:"element/delete.html",scope:{callback:"="},controller:["$scope","$attrs","$uibModal","$window","$parse",function($scope,$attrs,$uibModal,$window,$parse){angular.isUndefined($attrs.size)?$scope.size="lg":"lg"!=$attrs.size&&"sm"!=$attrs.size&&"xs"!=$attrs.size?$scope.size="lg":$scope.size=$attrs.size,angular.isUndefined($attrs.method)?$scope.method="post":"post"!=$attrs.method&&"delete"!=$attrs.method?$scope.method="post":$scope.method=$attrs.method,$scope.icon="fa fa-trash-o",angular.isUndefined($attrs.icon)||($scope.icon=$attrs.icon),$scope.deleteLoading=!1,$scope["delete"]=function(){$scope.deleteLoading=!0;var modalInstance=$uibModal.open({animation:!0,templateUrl:"element/delete-modal.html",controller:"DeleteModalController",resolve:{requestUrl:function(){return $attrs.url},requestParams:function(){var params={};return angular.forEach($attrs,function(value,key){"request"==key.substring(0,7)&&(this[key.substring(7).toLowerCase()]=value)},params),params},requestTitle:function(){return $attrs.title},requestContent:function(){return $attrs.content},requestMethod:function(){return $scope.method},requestIcon:function(){return $scope.icon}}});modalInstance.result.then(function(data){return angular.isDefined(data.redirect)?void($window.location.href=data.redirect):(angular.isDefined($scope.callback)&&$scope.callback(),void($scope.deleteLoading=!1))},function(){$scope.deleteLoading=!1})}}]}}]),angular.module("admin42").controller("DeleteModalController",["$scope","$uibModalInstance","$http","requestUrl","requestParams","requestTitle","requestContent","requestMethod","requestIcon",function($scope,$uibModalInstance,$http,requestUrl,requestParams,requestTitle,requestContent,requestMethod,requestIcon){$scope.title=requestTitle,$scope.content=requestContent,$scope.icon=requestIcon,$scope.deleteLoading=!1,$scope.ok=function(){$scope.deleteLoading=!0,$http({method:requestMethod.toUpperCase(),url:requestUrl,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:requestParams,transformRequest:function(obj){var str=[];for(var p in obj)str.push(encodeURIComponent(p)+"="+encodeURIComponent(obj[p]));return str.join("&")}}).success(function(data){$uibModalInstance.close(data)}).error(function(){$uibModalInstance.dismiss("cancel")})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),angular.module("admin42").factory("jsonCache",["$cacheFactory",function($cacheFactory){return $cacheFactory("json-cache")}]).directive("script",["jsonCache",function(jsonCache){return{restrict:"E",terminal:!0,compile:function(element,attr){if("application/json"==attr.type){var jsonHandler=attr.id,json=angular.fromJson(element[0].text);jsonCache.put(jsonHandler,json)}}}}]),angular.module("admin42").directive("lightbox",[function(){return{restrict:"A",link:function(scope,elem,attrs){$(elem).magnificPopup({type:"image",closeOnContentClick:!0,mainClass:"mfp-img-mobile",image:{verticalFit:!0}})}}}]),angular.module("admin42").directive("uiNav",[function(){return{restrict:"AC",link:function(scope,el,attr){var next,_window=$(window),_mb=768,wrap=$(".app-aside"),backdrop=".dropdown-backdrop";el.on("click","a",function(e){next&&next.trigger("mouseleave.nav");var _this=$(this);_this.parent().siblings(".active").toggleClass("active"),_this.next().is("ul")&&_this.parent().toggleClass("active")&&e.preventDefault(),_this.next().is("ul")||_window.width()<_mb&&$(".app-aside").removeClass("show off-screen")}),el.on("mouseenter","a",function(e){if(next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove(),!(!$(".app-aside-fixed.app-aside-folded").length||_window.width()<_mb||$(".app-aside-dock").length)){var top,_this=$(e.target),w_h=$(window).height(),offset=50,min=150;!_this.is("a")&&(_this=_this.closest("a")),_this.next().is("ul")&&(next=_this.next(),_this.parent().addClass("active"),top=_this.parent().position().top+offset,next.css("top",top),top+next.height()>w_h&&next.css("bottom",0),top+min>w_h&&next.css("bottom",w_h-top-offset).css("top","auto"),next.appendTo(wrap),next.on("mouseleave.nav",function(e){$(backdrop).remove(),next.appendTo(_this.parent()),next.off("mouseleave.nav").css("top","auto").css("bottom","auto"),_this.parent().removeClass("active")}),$(".smart").length&&$('<div class="dropdown-backdrop"/>').insertAfter(".app-aside").on("click",function(next){next&&next.trigger("mouseleave.nav")}))}}),wrap.on("mouseleave",function(e){next&&next.trigger("mouseleave.nav"),$("> .nav",wrap).remove()})}}}]),angular.module("admin42").directive("ngInitial",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$parse",function($scope,$element,$attrs,$parse){var getter,setter,val,tag;tag=$element[0].tagName.toLowerCase(),val=$attrs.initialValue||$element.val(),"input"===tag&&("checkbox"===$element.attr("type")?val=$element[0].checked?!0:void 0:"radio"===$element.attr("type")&&(val=$element[0].checked||void 0!==$element.attr("selected")?$element.val():void 0)),$attrs.ngModel&&(getter=$parse($attrs.ngModel),(setter=getter.assign)($scope,val))}]}}),angular.module("admin42").directive("stPersist",function(){return{require:"^stTable",link:function(scope,element,attr,ctrl){var nameSpace=attr.stPersist,forceReload=angular.isDefined(attr.stPersistForceReload);if(scope.$watch(function(){return ctrl.tableState()},function(newValue,oldValue){newValue!==oldValue&&localStorage.setItem(nameSpace,JSON.stringify(newValue))},!0),!forceReload&&localStorage.getItem(nameSpace)){var savedState=JSON.parse(localStorage.getItem(nameSpace)),tableState=ctrl.tableState();angular.extend(tableState,savedState),ctrl.pipe()}}}}),angular.module("smart-table").directive("stSearch42",["stConfig","$timeout","$parse",function(stConfig,$timeout,$parse){return{require:"^stTable",link:function(scope,element,attr,ctrl){var tableCtrl=ctrl,promise=null,throttle=attr.stDelay||stConfig.search.delay,event=attr.stInputEvent||stConfig.search.inputEvent;attr.$observe("stSearch42",function(newValue,oldValue){var input=element[0].value;newValue!==oldValue&&input&&tableCtrl.search(input,newValue)}),scope.$watch(function(){return ctrl.tableState().search},function(newValue,oldValue){var predicateExpression=attr.stSearch42||"$";newValue.predicateObject&&$parse(predicateExpression)(newValue.predicateObject)!==element[0].value&&(element[0].value=$parse(predicateExpression)(newValue.predicateObject)||"")},!0),element.bind(event,function(evt){evt=evt.originalEvent||evt,null!==promise&&$timeout.cancel(promise),promise=$timeout(function(){tableCtrl.search(evt.target.value,attr.stSearch42||""),promise=null},throttle)})}}}]),angular.module("admin42").directive("submit",[function(){return{restrict:"E",replace:!0,scope:{},templateUrl:"element/submit.html",link:function(scope,elem,attrs,ctrl){scope.icon="fa fa-save",angular.isUndefined(attrs.icon)||(scope.icon=attrs.icon),scope.btnClass="btn-primary",angular.isUndefined(attrs.btnClass)||(scope.btnClass=attrs.btnClass),scope.submitText="Save",angular.isUndefined(attrs.submitText)||(scope.submitText=attrs.submitText),scope.submitLoading=!1,elem.bind("click",function(event){return 1==scope.submitLoading?void event.preventDefault():void scope.$apply(function(){scope.submitLoading=!0})})}}}]),angular.module("admin42").directive("tinymce",["$rootScope","$compile","$timeout","$window","$sce","jsonCache",function($rootScope,$compile,$timeout,$window,$sce,jsonCache){return{require:["ngModel"],priority:599,link:function(scope,element,attrs,ctrls){function getInstance(){return tinymce.get(attrs.id)}if($window.tinymce){var ngModel=ctrls[0],updateView=function(editor){var content=editor.getContent({format:options.format}).trim();content=$sce.trustAsHtml(content),ngModel.$setViewValue(content),$rootScope.$$phase||scope.$digest()},expression={};angular.extend(expression,scope.$eval(attrs.options));var options={setup:function(ed){ed.on("init",function(){ngModel.$render(),ngModel.$setPristine(),ngModel.$setUntouched()}),ed.on("ExecCommand change NodeChange ObjectResized",function(){return options.debounce?void debouncedUpdate(ed):(ed.save(),void updateView(ed))}),ed.on("blur",function(){element[0].blur(),ngModel.$setTouched(),$rootScope.$$phase||scope.$digest()}),ed.on("remove",function(){}),expression.setup&&expression.setup(ed,{updateView:updateView})},format:"html",selector:"#"+attrs.id};angular.extend(options,expression);var debouncedUpdate=function(debouncedUpdateDelay){var debouncedUpdateTimer;return function(ed){$timeout.cancel(debouncedUpdateTimer),debouncedUpdateTimer=$timeout(function(){return function(ed){ed.isDirty()&&(ed.save(),updateView(ed))}(ed)},debouncedUpdateDelay)}}(400);$timeout(function(){options.baseURL&&(tinymce.baseURL=options.baseURL),tinymce.init(options)}),ngModel.$formatters.unshift(function(modelValue){return modelValue?$sce.trustAsHtml(modelValue):""}),ngModel.$parsers.unshift(function(viewValue){return viewValue?$sce.getTrustedHtml(viewValue):""}),ngModel.$render=function(){var tinyInstance=getInstance(),viewValue=ngModel.$viewValue?$sce.getTrustedHtml(ngModel.$viewValue):"";tinyInstance&&tinyInstance.getDoc()&&(tinyInstance.setContent(viewValue),tinyInstance.fire("change"))},scope.$on("$tinyWysiwyg:disable",function(){tinymce.EditorManager.execCommand("mceRemoveEditor",!1,attrs.id)}),scope.$on("$tinyWysiwyg:enable",function(){console.log(attrs.id),tinymce.EditorManager.execCommand("mceAddEditor",!1,attrs.id)})}}}}]),angular.module("admin42").directive("uiToggleClass",["$timeout","$document",function($timeout,$document){return{restrict:"AC",link:function(scope,el,attr){el.on("click",function(e){function magic(_class,target){for(var patt=new RegExp("\\s"+_class.replace(/\*/g,"[A-Za-z0-9-_]+").split(" ").join("\\s|\\s")+"\\s","g"),cn=" "+$(target)[0].className+" ";patt.test(cn);)cn=cn.replace(patt," ");$(target)[0].className=$.trim(cn)}e.preventDefault();var classes=attr.uiToggleClass.split(","),targets=attr.target&&attr.target.split(",")||Array(el),key=0;angular.forEach(classes,function(_class){var target=targets[targets.length&&key];-1!==_class.indexOf("*")&&magic(_class,target),$(target).toggleClass(_class),key++}),$(el).toggleClass("active")})}}}]),angular.module("admin42").directive("uibTabsetPersist",function(){return{require:"^uibTabset",link:function(scope,element,attr,ctrl){var nameSpace="uibTabsetPersist",id=attr.uibTabsetPersist,currentItem=JSON.parse(localStorage.getItem(nameSpace));currentItem&&currentItem.id==id,ctrl.select=function(selectedTab){console.log(ctrl)}}}}),angular.module("admin42").directive("formCheckbox",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","$formService","jsonCache",function($scope,$formService,jsonCache){function setValue(){$scope.formData.value=1==$scope.model?$scope.formData.checkedValue:$scope.formData.uncheckedValue}$scope.formData=jsonCache.get($scope.elementDataId),$scope.model=$scope.formData.value==$scope.formData.checkedValue,$scope.onChange=function(){setValue(),$scope.formData.errors=[]},setValue(),$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formCsrf",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formDate",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService","$filter",function($scope,jsonCache,$formService,$filter){$scope.formData=jsonCache.get($scope.elementDataId);var date=$scope.formData.value;date.length>0?$scope.value=moment(date).toDate():$scope.value="",$scope.popup={opened:!1},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.popup.opened=!0},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},$scope.empty=function(){$scope.value=""},$scope.$watch("value",function(newValue,oldValue){if(newValue!=oldValue){if(""==newValue)return void($scope.formData.value="");$scope.formData.value=$filter("date")(newValue,"yyyy-MM-dd")}},!0),$scope.dateOptions={formatYear:"yy",startingDay:1,showWeeks:!1},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formDatetime",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","appConfig","$formService",function($scope,jsonCache,appConfig,$formService){function getValue(date,time){if(null==date||null==time)return"";date=moment.tz(moment.utc(date),appConfig.displayTimezone),time=moment.tz(moment.utc(time),appConfig.displayTimezone);var result=moment.tz(date.format("YYYY-MM-DD")+" "+time.format("HH:mm"),appConfig.displayTimezone);return result.tz("UTC").format("YYYY-MM-DD HH:mm")+":00"}$scope.formData=jsonCache.get($scope.elementDataId);var date=$scope.formData.value;date.length>0?($scope.date=moment.tz(moment.utc(date),"UTC").toDate(),$scope.time=$scope.date):($scope.date=null,$scope.time=null),$scope.popup={opened:!1},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.popup.opened=!0},$scope.dateOptions={formatYear:"yy",startingDay:1,showWeeks:!1},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},$scope.empty=function(){$scope.date=null,$scope.time=null},$scope.$watch("date",function(newValue,oldValue){newValue!=oldValue&&newValue!=oldValue&&($scope.formData.value=getValue(newValue,$scope.time))},!0),$scope.$watch("time",function(newValue,oldValue){newValue!=oldValue&&($scope.formData.value=getValue($scope.date,newValue))},!0),angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formEmail",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.onChange=function(){$scope.formData.errors=[]},$scope.empty=function(){$scope.formData.value="",$scope.onChange()},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formFieldset",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$templateCache","$formService",function($scope,jsonCache,$templateCache,$formService){var elementData=jsonCache.get($scope.elementDataId);$scope.formData=elementData,$scope.formData.collapse=elementData.collapseAble,$scope.elements=[],angular.forEach(elementData.elements,function(element){var id=elementData.id+"-"+$scope.elements.length,templateName="element/form/fieldset/"+id+".html",elementOrFieldsetData=angular.copy(jsonCache.get(element.elementDataId)),elementOrFieldsetDataKey="element/form/value/"+id+".json";elementOrFieldsetData.id=id,elementOrFieldsetData.name=elementData.name+"["+elementOrFieldsetData.options.originalName+"]",jsonCache.put(elementOrFieldsetDataKey,elementOrFieldsetData),$templateCache.put(templateName,"<"+element.directive+' element-data-id="'+elementOrFieldsetDataKey+'" template="'+elementOrFieldsetData.template+'"></'+element.directive+">"),$scope.elements.push({template:templateName,elementDataId:elementOrFieldsetDataKey})}),angular.isDefined(elementData.options.formServiceHash)&&$formService.put(elementData.options.formServiceHash,elementData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formHidden",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formLink",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$uibModal","$sce","$formService",function($scope,jsonCache,$uibModal,$sce,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.getUrl=function(){return $sce.trustAsResourceUrl($scope.formData.value.previewUrl)},$scope.empty=function(){$scope.formData.value={linkId:null,linkType:null,linkValue:null,linkDisplayName:null,previewUrl:null},$scope.formData.errors=[]},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId),$scope.selectLink=function(){var modalInstance=$uibModal.open({animation:!0,templateUrl:"element/form/link-modal.html",controller:["$scope","$uibModalInstance","formData","$http",function($scope,$uibModalInstance,formData,$http){$scope.linkData=formData.value,$scope.availableLinkTypes=formData.availableLinkTypes,$scope.includeArray=[],$scope.link={setValue:function(value){$scope.linkData.linkValue=value},getValue:function(){return $scope.linkData.linkValue}},$scope.change=function(){return $scope.linkData.linkType.length>0?void($scope.includeArray=["link/"+$scope.linkData.linkType+".html"]):void($scope.includeArray=[])},null!==$scope.linkData.linkType&&$scope.change(),$scope.ok=function(){return null==$scope.linkData.linkValue||0==$scope.linkData.linkType.length?void $uibModalInstance.close({linkId:null,linkDisplayName:null,linkValue:null,linkType:null,previewUrl:null}):void $http({method:"POST",url:formData.saveUrl,data:{type:$scope.linkData.linkType,value:$scope.linkData.linkValue,id:$scope.linkData.linkId}}).success(function(data){$uibModalInstance.close({linkId:data.linkId,linkDisplayName:data.linkDisplayName,linkValue:$scope.linkData.linkValue,previewUrl:data.url,linkType:$scope.linkData.linkType})}).error(function(){$uibModalInstance.dismiss("cancel")})},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}],size:"lg",resolve:{formData:function(){return $scope.formData}}});modalInstance.result.then(function(data){$scope.formData.value.linkId=data.linkId,$scope.formData.value.linkDisplayName=data.linkDisplayName,$scope.formData.value.linkValue=data.linkValue,$scope.formData.value.linkType=data.linkType,$scope.formData.value.previewUrl=data.previewUrl,$scope.formData.errors=[]},function(){})}}]}}]),angular.module("admin42").directive("formMulticheckbox",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId);var initialValues=$scope.formData.value;$scope.values=[],$scope.options=$scope.formData.valueOptions,$scope.checkboxModel={},angular.forEach($scope.options,function(option){return angular.isArray(initialValues)?void angular.forEach(initialValues,function(initialValue){parseInt(initialValue)==parseInt(option.id)&&($scope.checkboxModel[option.id]=!0)}):void($scope.checkboxModel[option.id]=-1!=initialValues.indexOf(option.id))});var initial=!0;$scope.select=function(){var values=[];angular.forEach($scope.checkboxModel,function(value,index){value!==!1&&values.push(index)}),$scope.values=values,initial===!1&&($scope.formData.errors=[]),initial=!1},$scope.select(),$scope.empty=function(){angular.forEach($scope.checkboxModel,function(value,index){$scope.checkboxModel[index]=!1}),$scope.select()},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formPassword",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.showPassword=!1,$scope.empty=function(){$scope.formData.value="",$scope.onChange()},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},$scope.togglePassword=function(){$scope.showPassword=!$scope.showPassword},$scope.getInputType=function(){return $scope.showPassword?"text":"password"},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formRadio",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.options=$scope.formData.valueOptions,$scope.radioModel=$scope.formData.value,$scope.select=function(radioModel){$scope.formData.value=radioModel,$scope.formData.errors=[]},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formSelect",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){function setValue(){(parseInt($scope.formData.value)>0||$scope.formData.value.length>0)&&angular.forEach($scope.options,function(option){option.id==$scope.formData.value&&($scope.option.selected=option)})}$scope.formData=jsonCache.get($scope.elementDataId),$scope.option={},$scope.options=$scope.formData.valueOptions,$scope.searchEnabled=$scope.options.length>5,angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId),$scope.select=function($item,$model){$scope.formData.errors=[],$scope.formData.value=$model.id},0==$scope.formData.value.length&&null!==$scope.formData.emptyValue&&($scope.formData.value=$scope.formData.emptyValue),$scope.empty=function(){$scope.formData.value=$scope.formData.emptyValue,$scope.formData.errors=[],setValue()},setValue()}]}}]),angular.module("admin42").directive("formStack",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$templateCache","$formService",function($scope,jsonCache,$templateCache,$formService){var elementData=jsonCache.get($scope.elementDataId);$scope.label=elementData.label,$scope.protoTypes=elementData.protoTypes,$scope.data={selectedProtoType:$scope.protoTypes[0]},$scope.treeOptions={},$scope.sortingMode=!1,$scope.elements=[],angular.forEach(elementData.elements,function(element){var id=elementData.id+"-"+$scope.elements.length,templateName="element/form/stack/"+id+".html",elementOrFieldsetData=angular.copy(jsonCache.get(element.elementDataId)),elementOrFieldsetDataKey="element/form/value/"+id+".json";elementOrFieldsetData.id=id,elementOrFieldsetData.name=elementData.name+"["+elementOrFieldsetData.options.originalName+"]",jsonCache.put(elementOrFieldsetDataKey,elementOrFieldsetData),$templateCache.put(templateName,"<"+element.directive+' element-data-id="'+elementOrFieldsetDataKey+'" template="'+elementOrFieldsetData.template+'"></'+element.directive+">"),$scope.elements.push({formName:elementOrFieldsetData.name,type:elementOrFieldsetData.options.stackType,name:elementOrFieldsetData.options.fieldsetName,nameEditing:!1,template:templateName,elementDataId:elementOrFieldsetDataKey,label:elementOrFieldsetData.label,deleted:elementOrFieldsetData.options.fieldsetDeleted,collapsed:$scope.sortingMode,collapsedState:!1,nodes:[]})}),$scope.collapse=function(){angular.forEach($scope.elements,function(element){element.collapsed!==!0&&(element.collapsedState=element.collapsed,element.collapsed=!0)})},$scope.expand=function(){angular.forEach($scope.elements,function(element){element.collapsed=element.collapsedState})},$scope.preventEnter=function(element,$event){13==$event.keyCode&&(element.nameEditing=!1,$event.preventDefault())},$scope.startSortingMode=function(){return $scope.sortingMode===!1?($scope.$broadcast("$dynamic:sort-start"),$scope.sortingMode=!0,void $scope.collapse()):($scope.expand(),$scope.$broadcast("$dynamic:sort-stop"),void($scope.sortingMode=!1))},$scope.addTemplate=function(){var id=elementData.id+"-"+$scope.elements.length,element=$scope.data.selectedProtoType,templateName="element/form/stack/"+id+".html",elementOrFieldsetData=angular.copy(jsonCache.get(element.elementData)),elementOrFieldsetDataKey="element/form/value/"+id+".json";elementOrFieldsetData.id=id,elementOrFieldsetData.options.originalName=id,elementOrFieldsetData.name=elementData.name+"["+elementOrFieldsetData.options.originalName+"]",jsonCache.put(elementOrFieldsetDataKey,elementOrFieldsetData),$templateCache.put(templateName,"<"+element.directive+' element-data-id="'+elementOrFieldsetDataKey+'" template="'+elementOrFieldsetData.template+'"></'+element.directive+">"),$scope.elements.push({formName:elementOrFieldsetData.name,type:elementOrFieldsetData.options.stackType,name:"",nameEditing:!1,template:templateName,elementDataId:elementOrFieldsetDataKey,label:elementOrFieldsetData.label,deleted:!1,collapsed:$scope.sortingMode,collapsedState:!1,nodes:[]})},angular.isDefined(elementData.options.formServiceHash)&&$formService.put(elementData.options.formServiceHash,elementData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formSwitcher",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){function setValue(){$scope.formData.value=1==$scope.model?$scope.formData.checkedValue:$scope.formData.uncheckedValue}$scope.formData=jsonCache.get($scope.elementDataId),$scope.model=$scope.formData.value==$scope.formData.checkedValue,setValue(),$scope.onChange=function(){setValue(),$scope.formData.errors=[]},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formText",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.onChange=function(){$scope.formData.errors=[]},$scope.empty=function(){$scope.formData.value="",$scope.onChange()},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formTextarea",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$formService",function($scope,jsonCache,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.onChange=function(){$scope.formData.errors=[]},$scope.empty=function(){$scope.formData.value="",$scope.onChange()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formWysiwyg",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","$formService","jsonCache",function($scope,$formService,jsonCache){$scope.formData=jsonCache.get($scope.elementDataId),$scope.$on("$dynamic:sort-start",function(){$scope.$broadcast("$tinyWysiwyg:disable")}),$scope.$on("$dynamic:sort-stop",function(){$scope.$broadcast("$tinyWysiwyg:enable")}),$scope.empty=function(){$scope.formData.value=""},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId)}]}}]),angular.module("admin42").directive("formYoutube",[function(){return{restrict:"E",templateUrl:function(elem,attrs){return attrs.template},scope:{elementDataId:"@elementDataId"},controller:["$scope","jsonCache","$sce","$formService",function($scope,jsonCache,$sce,$formService){$scope.formData=jsonCache.get($scope.elementDataId),$scope.youtubeLink="",$scope.formData.value.length>0&&($scope.youtubeLink="https://www.youtube.com/watch?v="+$scope.formData.value),$scope.changeValue=function(){var regExp=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,match=$scope.youtubeLink.match(regExp);match&&11==match[2].length?($scope.formData.value=match[2],$scope.youtubeLink="https://www.youtube.com/watch?v="+$scope.formData.value):$scope.formData.value="",$scope.formData.errors=[]},$scope.videoUrl=function(){return $sce.trustAsResourceUrl("https://www.youtube.com/embed/"+$scope.formData.value)},$scope.empty=function(){$scope.youtubeLink="",$scope.changeValue()},$scope.preventEnter=function($event){13==$event.keyCode&&$event.preventDefault()},angular.isDefined($scope.formData.options.formServiceHash)&&$formService.put($scope.formData.options.formServiceHash,$scope.formData.name,$scope.elementDataId);
}]}}]),angular.module("admin42").filter("bytes",function(){return function(bytes){if(isNaN(parseFloat(bytes))||!isFinite(bytes)||0==bytes)return"0";var measure,floor,precision,units={1:"KB",2:"MB",3:"GB",4:"TB"};return bytes>0xffffffffff?measure=4:bytes>1048575999&&0xffffffffff>=bytes?measure=3:bytes>1024e3&&1048575999>=bytes?measure=2:1024e3>=bytes&&(measure=1),floor=Math.floor(bytes/Math.pow(1024,measure)).toString().length,precision=floor>3?0:3-floor,(bytes/Math.pow(1024,measure)).toFixed(precision)+" "+units[measure]}}),angular.module("admin42").filter("datetime",function(appConfig){return function(input,emptyValue,format,timezone){angular.isUndefined(emptyValue)&&(emptyValue="-"),angular.isUndefined(format)&&(format=appConfig.defaultDateTimeFormat),angular.isUndefined(timezone)&&(timezone=appConfig.displayTimezone);var dateTime;if(angular.isObject(input)&&"[object Date]"==Object.prototype.toString.call(input))dateTime=moment.tz(moment.utc(input),input.timezone),dateTime=moment.tz(dateTime,timezone);else if(angular.isObject(input)){if(angular.isUndefined(input.date))return emptyValue;dateTime=moment.tz(moment.utc(input.date),input.timezone),dateTime=moment.tz(dateTime,timezone)}else{if(!angular.isString(input))return emptyValue;if(0==input.length)return emptyValue;dateTime=moment.tz(moment.utc(input),timezone)}return dateTime.locale(appConfig.locale),dateTime.format(format)}}),angular.module("admin42").controller("AppController",["$scope","toaster","$timeout","$localStorage",function($scope,toaster,$timeout,$localStorage){$scope.app={$storage:$localStorage.$default({asideFolded:!1})},$scope.app.appContentFull=!1,"undefined"!=typeof FLASH_MESSAGE&&$timeout(function(){angular.forEach(FLASH_MESSAGE,function(messages,namespace){0!=messages.length&&angular.forEach(messages,function(message){toaster.pop(namespace,message.title,message.message)})})},1e3)}]),angular.module("admin42").controller("DataGridController",["$scope","$http","$attrs","$sessionStorage","$templateCache",function($scope,$http,$attrs,$sessionStorage,$templateCache){$templateCache.put("template/smart-table/pagination.html",'<nav ng-if="numPages && pages.length >= 2"><ul class="pagination"><li ng-if="currentPage > 1"><a ng-click="selectPage(1)"><i class="fa fa-angle-double-left"></i></a></li><li ng-if="currentPage > 1"><a ng-click="selectPage(currentPage - 1)"><i class="fa fa-angle-left"></i></a></li><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li><li ng-if="currentPage < numPages"><a ng-click="selectPage(currentPage + 1)"><i class="fa fa-angle-right"></i></a></li><li ng-if="currentPage < numPages"><a ng-click="selectPage(numPages)"><i class="fa fa-angle-double-right"></i></a></li></ul></nav>');var url=$attrs.url,isInitialCall=!0,persistNamespace=null;angular.isDefined($attrs.persist)&&$attrs.persist.length>0&&(persistNamespace=$attrs.persist),$scope.collection=[],$scope.isLoading=!0,$scope.displayedPages=1,$scope.callServer=function(tableState){$scope.collection=[],$scope.isLoading=!0,isInitialCall===!0&&null!==persistNamespace?angular.isDefined($sessionStorage.smartTable)&&angular.isDefined($sessionStorage.smartTable[persistNamespace])&&angular.extend(tableState,angular.fromJson($sessionStorage.smartTable[persistNamespace])):null!==persistNamespace&&(angular.isUndefined($sessionStorage.smartTable)&&($sessionStorage.smartTable={}),$sessionStorage.smartTable[persistNamespace]=angular.toJson(tableState)),isInitialCall=!1,$http.post(url,tableState).success(function(data,status,headers,config){$scope.isLoading=!1,$scope.collection=data.data,$scope.displayedPages=data.meta.displayedPages,tableState.pagination.numberOfPages=data.meta.displayedPages}).error(function(data,status,headers,config){})}}]),angular.module("admin42").controller("LinkController",["$scope","$http","jsonCache",function($scope,$http,jsonCache){$scope.availableLinkTypes=jsonCache.get("link/availableAdapters.json"),$scope.linkData=jsonCache.get("link/linkData.json"),$scope.includeArray=[],$scope.change=function(){return $scope.linkData.linkType.length>0?void($scope.includeArray=["link/"+$scope.linkData.linkType+".html"]):void($scope.includeArray=[])},null!==$scope.linkData.linkType&&$scope.change(),$scope.link={setValue:function(value){$scope.linkData.linkValue=value},getValue:function(){return $scope.linkData.linkValue}}}]),angular.module("admin42").controller("ModalController",["$scope","$uibModalInstance",function($scope,$uibModalInstance){$scope.ok=function(){$uibModalInstance.close()},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),angular.module("admin42").controller("TagsElementController",["$scope","$attrs","$http","$q","jsonCache",function($scope,$attrs,$http,$q,jsonCache){var url=$attrs.url,canceler=null;$scope.tags={tags:[],selectedTags:jsonCache.get($attrs.jsonDataId),fieldValue:""},$scope.addTagTransform=function(tag){return{id:0,tag:tag}},$scope.updateHiddenField=function(){var fieldValue="";angular.forEach($scope.tags.selectedTags,function(value,key){fieldValue+=value.tag+","}),$scope.tags.fieldValue=fieldValue.substring(0,fieldValue.length-1)},$scope.updateHiddenField(),$scope.refreshTags=function(tag){$scope.tags.tags=[];var params={tag:tag};if(tag.length>0){null!=canceler&&canceler.resolve(),canceler=$q.defer();var request=$http({method:"get",url:url,params:params,timeout:canceler.promise});request.then(function(response){$scope.canceler=null,$scope.tags.tags=response.data.results})}}}]),angular.module("admin42").controller("LinkExternController",["$scope",function($scope){var inititalValue=$scope.link.getValue();null!=inititalValue?($scope.externType=inititalValue.type,$scope.externUrl=inititalValue.url):$scope.externType="http://",$scope.change=function(){$scope.link.setValue({type:$scope.externType,url:$scope.externUrl})}}]);